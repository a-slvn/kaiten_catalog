# План тестирования: Каталоги → Поля → Карточки

Полный flow: создание каталогов, привязка через пользовательские поля, работа из карточки сделки.

## Требования

### MCP серверы

| MCP сервер | Назначение |
|---|---|
| **chrome-devtools** | Взаимодействие с браузером: клики, ввод, скриншоты, snapshot, консоль |

### Агент и скилл

- **Скилл:** `/test-ui` (файл `.claude/commands/test-ui.md`)
- **Агент:** основной Claude Code
- **Модель:** sonnet или opus

### Навыки агента

1. **Навигация по UI** — находить элементы через a11y-snapshot, кликать, вводить текст
2. **Визуальная проверка** — скриншоты, оценка вёрстки
3. **Проверка ошибок** — консоль браузера, JS-ошибки
4. **Тестирование форм** — заполнение, валидация, сабмит
5. **Тестирование CRUD** — создание, чтение, обновление, удаление
6. **Граничные случаи** — пустые поля, длинный текст, спецсимволы, дубли
7. **Адаптивность** — проверка на разных viewport

### Предусловия

- Chrome открыт с DevTools Protocol
- Dev-сервер запущен на `localhost:5173`
- localStorage чистый (или с нужным начальным состоянием)

---

## Этап 1: Создание каталогов

**Цель:** Проверить создание каталогов и записей.

**Навигация:** Боковое меню → Администрирование → Каталоги

| # | Действие | Ожидаемый результат |
|---|---|---|
| 1.1 | Открыть страницу каталогов | Страница отображается |
| 1.2 | Нажать кнопку создания каталога | Диалог создания |
| 1.3 | Создать каталог «Контакты»: ФИО (text, обязательное), Email (email), Телефон (phone) | Каталог в списке |
| 1.4 | Создать каталог «Компании»: Название (text, обязательное), ИНН (numeric), Сайт (url) | Каталог в списке |
| 1.5 | Открыть «Контакты», добавить: Иванов Иван, ivan@test.com, +79001234567 | Запись в таблице |
| 1.6 | Добавить: Петрова Мария, maria@test.com, +79007654321 | Запись в таблице |
| 1.7 | Открыть «Компании», добавить: ООО Ромашка, 1234567890, romashka.ru | Запись в таблице |
| 1.8 | Добавить: ИП Василёк, 9876543210, vasilek.ru | Запись в таблице |

**Кривые кейсы:**
- Создать каталог без названия → валидация
- Создать каталог без полей → валидация
- Два каталога с одинаковым именем → что произойдёт?
- Удалить каталог с записями → подтверждение? Каскадное удаление?

---

## Этап 2: Создание пользовательских полей

**Цель:** Создать поля типа «Каталог», привязанные к каталогам.

**Навигация:** Боковое меню → Администрирование → Пользовательские поля

| # | Действие | Ожидаемый результат |
|---|---|---|
| 2.1 | Открыть страницу пользовательских полей | Страница отображается |
| 2.2 | Нажать кнопку создания поля | Диалог |
| 2.3 | Название «Контакт», тип «Каталог» | Появляется выбор каталога |
| 2.4 | Выбрать каталог «Контакты» → Сохранить | Поле в таблице, тип «Каталог» |
| 2.5 | Создать поле «Компания» типа «Каталог» → «Компании» → Сохранить | Поле в таблице |
| 2.6 | Проверить оба поля: тип, название каталога | Корректное отображение |

**Кривые кейсы:**
- Поле без названия → валидация
- Тип «Каталог» без выбора каталога → валидация
- Два поля с одинаковым именем → что произойдёт?
- Редактирование существующего поля → сохраняется?

---

## Этап 3: Добавление полей в карточку сделки

**Цель:** Добавить поля к сделке через DealModal.

**Навигация:** Канбан-доска → клик по карточке

| # | Действие | Ожидаемый результат |
|---|---|---|
| 3.1 | Перейти на канбан-доску | Доска с колонками и карточками |
| 3.2 | Кликнуть на карточку сделки | Открывается DealModal |
| 3.3 | Нажать «+» для добавления поля | Меню доступных полей |
| 3.4 | Выбрать «Контакт» | Поле появляется в модалке |
| 3.5 | Нажать «+», выбрать «Компания» | Поле появляется в модалке |
| 3.6 | Проверить отображение обоих полей | Видны поля типа каталог |

---

## Этап 4: Работа с каталожными полями из карточки

**Цель:** Выбрать и создать записи каталога из карточки сделки.

| # | Действие | Ожидаемый результат |
|---|---|---|
| 4.1 | В поле «Контакт» кликнуть для выбора | Выпадашка с записями «Контакты» |
| 4.2 | Выбрать «Иванов Иван» | Контакт привязан, отображается |
| 4.3 | В поле «Контакт» нажать «Создать новый» | Диалог создания записи |
| 4.4 | Заполнить: Сидоров Пётр, petr@test.com, +79005551234 → Сохранить | Контакт создан и привязан |
| 4.5 | В поле «Компания» выбрать «ООО Ромашка» | Компания привязана |
| 4.6 | В поле «Компания» создать: ООО Тюльпан, 5555555555, tulpan.ru | Компания создана и привязана |
| 4.7 | Закрыть модалку (Escape или кнопка) | Закрылась |
| 4.8 | Снова открыть ту же карточку | Данные сохранились |

---

## Этап 5: Проверка сохранения в каталогах

**Цель:** Записи из карточки должны появиться в каталогах.

| # | Действие | Ожидаемый результат |
|---|---|---|
| 5.1 | Каталоги → «Контакты» | Таблица записей |
| 5.2 | Найти «Сидоров Пётр» | Запись есть |
| 5.3 | Открыть запись | ФИО, Email, Телефон заполнены |
| 5.4 | Перейти в «Компании» | Таблица записей |
| 5.5 | Найти «ООО Тюльпан» | Запись есть |
| 5.6 | Открыть запись | Название, ИНН, Сайт заполнены |

---

## Этап 6: Граничные случаи

| # | Кейс | Что проверяем |
|---|---|---|
| 6.1 | Удалить запись каталога, привязанную к сделке | Отображение в DealModal, нет краша |
| 6.2 | Удалить каталог с привязанным полем | Что с полем? Ошибки? |
| 6.3 | Множественный выбор записей (если multiple) | Работает? |
| 6.4 | Пустые обязательные поля при создании записи | Валидация |
| 6.5 | Очень длинные названия (100+ символов) | Вёрстка цела |
| 6.6 | Спецсимволы: `<script>`, кавычки, эмодзи | XSS? Отображение? |
| 6.7 | Двойной клик на кнопку создания | Нет дубля |
| 6.8 | Консоль на JS-ошибки | Чисто |

---

## Этап 7: Адаптивность

| Viewport | Размер | Проверяем |
|----------|--------|-----------|
| Desktop | 1920x1080 | Основной вид |
| Laptop | 1366x768 | Нет горизонтального скролла |
| Tablet | 768x1024 | Меню адаптируется, таблицы читаемы |
| Mobile | 375x812 | Модалки не вылезают за экран |
