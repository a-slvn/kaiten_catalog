# CRM-система: Архитектура прототипа

## Общая концепция

CRM-система типа Kaiten с поддержкой **кастомных справочников** и **каталогов**. Главная идея: пользователь сам создаёт структуры данных (каталоги) и связывает их между собой.

```
┌─────────────────────────────────────────────────────────────────┐
│                         TopBar                                   │
├──────────┬──────────────────────────────────────────────────────┤
│          │                                                       │
│ Sidebar  │              Контент (зависит от выбранного пункта)  │
│          │                                                       │
│ • Каталоги│    ┌─────────────────────────────────────────────┐   │
│ • Поля   │    │  Список каталогов / Пользовательские поля / │   │
│ • Доска  │    │  Детальная страница каталога / Kanban-доска │   │
│          │    └─────────────────────────────────────────────┘   │
└──────────┴──────────────────────────────────────────────────────┘
```

---

## Ключевые сущности

### Каталог
Шаблон/схема для хранения данных (аналог таблицы в БД).

**Пример**: Каталог "Компании" с полями:
- Название (текст, обязательное)
- ИНН (число)
- Контакт (ссылка на справочник "Контакты")

### Запись каталога
Конкретная запись в каталоге (аналог строки в таблице).

### Пользовательское поле
Глобальные поля, которые можно добавлять к карточкам на доске (сделкам).

---

## Типы полей

| Тип | Описание | Пример использования |
|-----|----------|---------------------|
| Строка | Текстовое поле | Названия, имена |
| Число | Числовое поле | ИНН, суммы |
| Телефон | Поле для телефона | +7 формат |
| Email | Поле для email | Валидация email |
| URL | Поле для ссылки | Сайты |
| Селект | Выбор из списка | Статусы |
| Мультиселект | Множественный выбор | Теги |
| **Справочник** | Ссылка на запись справочника | Связь с контактом |
| **Каталог** | Ссылка на запись каталога | Связь с компанией |

---

## Связи между сущностями

```
┌─────────────┐         ┌─────────────┐
│  КАТАЛОГ    │         │ СПРАВОЧНИК  │
│ "Компании"  │         │ "Контакты"  │
├─────────────┤         ├─────────────┤
│ Название    │         │ Имя         │
│ ИНН         │         │ Телефон     │
│ Контакт ────┼────────►│ Должность   │
└─────────────┘         │ Компания ───┼──┐
                        └─────────────┘  │
                               ▲         │
                               └─────────┘
                          (обратная связь)
```

Поля типа "Справочник" и "Каталог" создают связи между записями разных каталогов.

---

## Логика создания связанных записей

При заполнении поля-ссылки (например, "Контакт" в компании):

```
Пользователь заполняет форму "Новая компания"
                    │
                    ▼
         Поле "Контакт" (справочник)
                    │
         ┌──────────┴──────────┐
         ▼                     ▼
    Есть контакты?        Нет контактов?
         │                     │
         ▼                     ▼
   Выпадающий список      Кнопка "Создать
   для выбора             новую запись"
                               │
                               ▼
                    Открывается диалог
                    создания контакта
```

Это позволяет создавать связанные записи "на лету", не выходя из текущей формы.

---

## Основные экраны

### 1. Каталоги
- Список всех каталогов с информацией: название, количество полей, количество записей
- Кнопка "Создать каталог"
- Действия: редактировать, удалить

### 2. Детальная страница каталога
- Название каталога и статистика
- Поиск по всем полям
- Таблица записей с сортировкой
- Кнопка "Добавить запись"
- Действия над записями: просмотр, редактировать, удалить

### 3. Пользовательские поля
- Вкладки: Активные поля / Деактивированные поля
- Таблица с колонками: Название, ID, Тип, Виден на фасаде карточек, Автор, Использование ограничено, Действия
- Кнопка "Добавить пользовательское поле"

### 4. Доска (Kanban)
- Колонки со сделками
- Карточки сделок с кастомными полями
- Drag & drop между колонками

---

## Типичные сценарии использования

### Создать каталог "Компании"
1. Боковое меню → Каталоги
2. Кнопка "Создать каталог"
3. Ввести название "Компании"
4. Добавить поля: Название (текст), ИНН (число), Контакт (справочник → Контакты)
5. Сохранить

### Добавить запись в каталог
1. Открыть каталог "Компании"
2. Кнопка "Добавить запись"
3. Заполнить поля
4. В поле "Контакт" → выбрать из списка или создать нового
5. Сохранить

### Связать записи
1. Поле типа "Справочник" → выбор из записей другого справочника
2. Поле типа "Каталог" → выбор из записей другого каталога
3. При отсутствии записей → можно создать прямо из формы

---

## Навигация

Боковое меню содержит разделы:

**Личное**
- Карточки
- Блокеры
- Активности
- Учёт времени

**Администрирование**
- Учёт времени
- Служба поддержки
- Типы карточек
- Виды карточек
- Метки
- Оплата
- Настройки компании
- Пользователи
- Роли пользователей
- **Пользовательские поля** ← основной раздел
- **Каталоги** ← основной раздел
- Журнал событий
- Экспорт данных компании
- Календари
- Журнал аудита
- Ресурсное планирование
- Категории блокировки

---

## Стек технологий

- React + TypeScript
- MUI (Material-UI)
- Vite
- Context API для состояния
