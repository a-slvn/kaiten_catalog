# Миграция localStorage для FieldsWorkspacePage

## Проблема
На странице FieldsWorkspacePage возникал белый экран из-за несовместимости форматов данных в localStorage:
- Старый формат: `workspace_selected_fields` - простой массив ID полей
- Новый формат: `workspace_settings` - объект с расширенными настройками

## Решение

### 1. Автоматическая миграция данных
Добавлена функция `migrateOldData()` которая:
- Проверяет наличие старого ключа `workspace_selected_fields`
- Преобразует массив в новый формат объекта
- Сохраняет данные в новом ключе `workspace_settings`
- Удаляет старый ключ

### 2. Валидация данных
Добавлена функция `validateSettings()` которая:
- Проверяет структуру загруженных данных
- Фильтрует невалидные значения
- Возвращает дефолтные значения при ошибках
- Логирует все проблемы в консоль

### 3. Защита от ошибок
Добавлены try-catch блоки в:
- Инициализации state (при загрузке из localStorage)
- Сохранении настроек (useEffect)
- Применении настроек из диалога
- Инициализации временных настроек

### 4. Отладочные логи
Добавлено логирование с префиксом `[FieldsWorkspace]`:
- Процесс миграции данных
- Валидация и ошибки
- Сохранение и загрузка настроек
- Stack trace при критических ошибках

## Формат данных

### Старый формат (workspace_selected_fields)
```json
["field-id-1", "field-id-2", "field-id-3"]
```

### Новый формат (workspace_settings)
```json
{
  "selectedFieldIds": ["field-id-1", "field-id-2"],
  "accessSettings": {
    "type": "all",
    "users": [],
    "groups": []
  }
}
```

## Дефолтные значения
При любых ошибках или отсутствии данных используются:
```typescript
{
  selectedFieldIds: [],
  accessSettings: {
    type: 'all',
    users: [],
    groups: []
  }
}
```

## Отладка
При проблемах с данными проверьте консоль браузера на наличие сообщений с префиксом `[FieldsWorkspace]`.
