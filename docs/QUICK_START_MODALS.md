# Быстрый старт: Модальные окна контактов и компаний

## Что реализовано

Добавлены модальные окна для просмотра и редактирования записей справочников (контактов и компаний) с полным функционалом:

### Возможности

1. **Просмотр информации**
   - Все поля записи с правильным форматированием
   - Клик по reference полям открывает связанные записи
   - Метаданные: дата создания, автор, дата обновления

2. **Связанные записи**
   - Для компаний: список контактов
   - Для контактов: информация о компании
   - Навигация между записями одним кликом

3. **Связанные сделки**
   - Список всех сделок, где используется запись
   - Визуальное отображение с суммами и статусами

4. **Редактирование**
   - Полноценная форма редактирования
   - Поддержка всех типов полей
   - Валидация обязательных полей
   - Сохранение изменений в localStorage

## Как использовать

### Шаг 1: Создайте справочники

1. Перейдите в раздел "Кастомные Поля"
2. Создайте справочник "Компании":
   - Добавьте поля: Название, Адрес, Телефон, Email
3. Создайте справочник "Контакты":
   - Добавьте поля: ФИО, Телефон, Email
   - Добавьте reference поле "Компания" (ссылка на справочник Компании)

### Шаг 2: Добавьте записи

1. В разделе "Кастомные Поля" откройте справочник "Компании"
2. Создайте несколько компаний
3. Откройте справочник "Контакты"
4. Создайте контакты, привязав их к компаниям

### Шаг 3: Откройте модальное окно

1. Перейдите в раздел "Данные CRM"
2. Нажмите "Настроить поля" и выберите справочники для отображения
3. Кликните на любую запись в таблице

### Шаг 4: Исследуйте возможности

**Вкладка "Информация":**
- Просмотрите все поля записи
- Кликните на чип компании, чтобы перейти к её карточке

**Вкладка "Связанные":**
- Для компании: список всех контактов этой компании
- Для контакта: компания, к которой он привязан

**Вкладка "Сделки":**
- Просмотрите сделки, где используется эта запись
- Видны суммы и статусы сделок

**Вкладка "Редактирование":**
- Нажмите кнопку "Изменить" в заголовке
- Отредактируйте нужные поля
- Нажмите "Сохранить" или "Отмена"

## Примеры использования

### Сценарий 1: Просмотр контакта с его компанией

1. Откройте таблицу контактов в "Данные CRM"
2. Кликните на контакт
3. На вкладке "Информация" кликните на компанию
4. Откроется модальное окно компании
5. На вкладке "Контакты" увидите всех сотрудников этой компании

### Сценарий 2: Редактирование компании

1. Откройте карточку компании
2. Нажмите "Изменить" в правом верхнем углу
3. Измените адрес и телефон
4. Нажмите "Сохранить"
5. Изменения сохранятся и отобразятся во всех местах

### Сценарий 3: Просмотр сделок контакта

1. Откройте карточку контакта
2. Перейдите на вкладку "Сделки"
3. Увидите все сделки, где указан этот контакт
4. Информация обновляется автоматически при добавлении новых сделок

## Технические детали

### Файлы

- `/src/components/ReferenceRecordModal.tsx` - основной компонент модального окна
- `/src/context/DealsContext.tsx` - контекст для работы со сделками
- `/src/hooks/useDeals.ts` - хук для получения связанных сделок

### Хранение данных

Все данные хранятся в localStorage:
- Записи справочников
- Связи между записями
- История изменений

### API компонента

```tsx
<ReferenceRecordModal
  open={boolean}                    // Открыто/закрыто
  entryId={string | null}           // ID записи
  onClose={() => void}              // Закрытие окна
  onNavigateToEntry={(id) => void}  // Навигация к другой записи
  deals={Deal[]}                    // Связанные сделки
/>
```

## Клавиатурные сокращения

- `Esc` - закрыть модальное окно
- `Tab` - переключение между полями в режиме редактирования

## Устранение неполадок

### Модальное окно не открывается

1. Проверьте, что запись существует в localStorage
2. Откройте консоль браузера и проверьте ошибки
3. Убедитесь, что справочник активен

### Нет связанных записей

1. Убедитесь, что reference поля правильно настроены
2. Проверьте, что записи действительно связаны через reference поля
3. Перезагрузите страницу для обновления кэша

### Изменения не сохраняются

1. Проверьте, что обязательные поля заполнены
2. Убедитесь, что localStorage не переполнен
3. Попробуйте очистить localStorage и создать данные заново

## Дальнейшее развитие

Планируемые улучшения:
- История изменений записи
- Комментарии и заметки
- Прикрепление файлов
- Экспорт данных
- Массовое редактирование

## Поддержка

Для получения дополнительной информации см.:
- `MODAL_WINDOWS_GUIDE.md` - подробное руководство
- `USER_GUIDE.md` - общее руководство пользователя
- `REFERENCE_LINKS_GUIDE.md` - руководство по справочникам
