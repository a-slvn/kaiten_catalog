# Техническая спецификация: Каталоги и Справочники

> **Версия:** 1.0
> **Статус:** Спецификация для разработки

---

## 1. Общее описание

Система расширяется двумя связанными сущностями:
- **Справочники** — простые списки значений для выбора
- **Каталоги** — структурированные таблицы данных с произвольными полями

Обе сущности могут использоваться в карточках сделок как пользовательские поля.

---


## 3. Справочники

### 3.1 Что это такое

Справочник — это простой список записей с настраиваемой структурой

### 3.2 Создание справочника

При создании справочника указывается:
- **Название справочника** (обязательно)

### 3.3 Поля справочника

Для каждого поля указывается:
- **Название поля** (обязательно)
- **Тип поля** (обязательно)
- **Обязательность** (да/нет)

Доступные типы полей в справочнике:
- Текст
- Email
- Телефон
- Ссылка
- Число
- Выпадающий список
- Множественный выбор

---

## 4. Каталоги

### 4.1 Что это такое

Каталог — это структурированная таблица данных с произвольными полями. 

### 4.2 Расположение в интерфейсе

В левом меню, в разделе "Администрирование", добавляется пункт **"Каталоги"**.

### 4.3 Создание каталога

При создании каталога указывается:
- **Название каталога** (обязательно)

### 4.4 Поля каталога

После создания каталога добавляются поля. Для каждого поля указывается:
- **Название поля** (обязательно)
- **Тип поля** (обязательно)
- **Обязательность** (да/нет)

Доступные типы полей в каталоге:
- Текст
- Email
- Телефон
- Ссылка
- Число
- Выпадающий список
- Множественный выбор
- **Справочник** — ссылка на запись из справочника

### 4.5 Связь каталога со справочником

При выборе типа поля "Справочник":
1. Появляется выпадающий список
2. В списке отображаются все существующие справочники
3. Выбирается нужный справочник

**Пример использования:** Каталог "Контакты" может иметь поле "Компания" типа "Справочник", которое ссылается на каталог "Компании". Это позволяет связать контакт с компанией.

### 4.6 Управление полями

- Можно добавить сколько угодно полей
- Можно удалить любое поле
- Можно изменить порядок полей

После настройки полей нажимается кнопка **"Создать"**.

---

## 5. Страница списка каталогов

После создания каталогов отображается список всех каталогов.

### 5.1 Информация в списке

Для каждого каталога показывается:
- Название каталога
- Количество записей
- Дата создания

### 5.2 Действия со списком

- **Редактировать** — изменить название и структуру полей каталога
- **Удалить** — удалить каталог и все его записи
- **Открыть** — перейти к записям каталога

---

## 6. Страница записей каталога

При клике на каталог открывается страница с записями этого каталога.

### 6.1 Отображение записей

Записи отображаются в виде таблицы, где:
- Колонки — это поля каталога
- Строки — это записи

### 6.2 Действия с записями

- **Добавить** — создать новую запись
- **Редактировать** — изменить существующую запись
- **Удалить** — удалить запись
- **Поиск** — найти записи по тексту
- **Фильтрация** — отфильтровать записи по значениям полей

---

## 7. Использование в карточке сделки

### 7.1 Добавление поля в карточку

Каталоги и справочники можно добавить в карточку сделки как пользовательское поле:
1. В разделе "Пользовательские поля"
3. Выбирается конкретный каталог или справочник
4. Поле появляется в карточке сделки

### 7.2 Работа менеджера с карточкой

Менеджер в карточке сделки может:
- Видеть связанные записи из каталогов (компания, контакт и т.д.)
- Выбирать записи из выпадающего списка
- Заполнять и сохранять данные

### 7.3 Права на редактирование

Если у менеджера есть соответствующие права, он может прямо из карточки сделки:
- **Редактировать** существующие записи каталога
- **Создавать** новые записи (например, новый контакт)
- **Удалять** записи

---

## 8. Навигация между сущностями

### 8.1 Связь Сделка — Компания — Контакт

Три основные сущности связаны между собой:
- **Сделка** содержит ссылки на Компанию и Контакт
- **Компания** содержит список связанных Контактов и Сделок
- **Контакт** содержит ссылку на Компанию и список Сделок

### 8.2 Просмотр связанных данных

**Из карточки сделки:**
- Клик на контакт → открывается карточка контакта
- Клик на компанию → открывается карточка компании

**Из карточки контакта:**
- Видно, к какой компании относится контакт
- Видно, какие сделки связаны с контактом
- Клик на компанию → переход в карточку компании
- Клик на сделку → переход в карточку сделки

**Из карточки компании:**
- Видно, какие контакты относятся к компании
- Видно, какие сделки связаны с компанией
- Клик на контакт → переход в карточку контакта
- Клик на сделку → переход в карточку сделки

### 8.3 Цепочка переходов

Пользователь может свободно переходить между всеми тремя сущностями в любом направлении:

```
Сделка ←→ Компания ←→ Контакт
   ↑                      ↑
   └──────────────────────┘
```

---

## 9. Типичные сценарии использования

### Сценарий 1: Настройка CRM для работы с клиентами

1. Администратор создает каталог "Компании" с полями:
   - Название (текст, обязательное)
   - ИНН (текст)
   - Адрес (текст)
   - Телефон (телефон)
   - Email (email)

2. Администратор создает каталог "Контакты" с полями:
   - ФИО (текст, обязательное)
   - Должность (текст)
   - Телефон (телефон)
   - Email (email)
   - Компания (справочник → Компании)

3. Администратор добавляет в карточку сделки пользовательские поля:
   - "Компания" (тип: каталог → Компании)
   - "Контакт" (тип: каталог → Контакты)

### Сценарий 2: Работа менеджера со сделкой

1. Менеджер открывает карточку сделки
2. В поле "Компания" выбирает существующую компанию или создает новую
3. В поле "Контакт" выбирает контакт или создает нового
4. При необходимости кликает на компанию, чтобы посмотреть все её контакты
5. Из карточки компании может перейти к любой связанной сделке

---

## 10. Итоговая структура

### Меню "Администрирование":
```
├── Пользовательские поля
│   └── (типы полей: ... + Справочник + Каталог)
│
├── Каталоги  ← НОВЫЙ РАЗДЕЛ
│   ├── Список каталогов
│   │   ├── Создать каталог
│   │   ├── Редактировать каталог
│   │   └── Удалить каталог
│   │
│   └── Записи каталога
│       ├── Добавить запись
│       ├── Редактировать запись
│       ├── Удалить запись
│       ├── Поиск
│       └── Фильтрация
```

### Карточка сделки:
```
├── Основные поля сделки
├── Пользовательские поля
│   ├── Поле типа "Каталог" (например, Компания)
│   │   └── Выбор записи / Создание / Редактирование
│   │
│   └── Поле типа "Каталог" (например, Контакт)
│       └── Выбор записи / Создание / Редактирование
```

---

## 11. Ограничения и правила

1. **Название каталога** — обязательное поле при создании
2. **Название поля** — обязательное поле при добавлении поля в каталог
3. **Тип поля** — обязательно выбрать при создании поля
4. При удалении каталога удаляются все его записи
5. При удалении справочника необходимо проверить, не используется ли он в каталогах
6. Права на создание/редактирование/удаление записей из карточки сделки настраиваются в системе прав
